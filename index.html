<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EN ‚áÑ CA Flashcards</title>
  <style>
    :root {
      --bg: #f7f7f7;
      --card: #ffffff;
      --ink: #111827;
      --muted: #374151;
      --accent: #22c55e;
    }
    body.dark {
      --bg: #0f172a;
      --card: #111827;
      --ink: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
    }
    html,body {height:100%}
    body {
      margin:0;
      background: var(--bg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .wrap{width:min(900px,95vw);padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    header h1{font-size:1.1rem;font-weight:600;margin:0;color:var(--ink)}
    header .sub{color:var(--muted);font-size:.9rem}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button,input[type="file"],select{
      background:var(--card);
      border:1px solid rgba(0,0,0,0.12);
      border-radius:12px;
      color:var(--ink);
      padding:8px 12px;
      font-weight:600;
      cursor:pointer;
      transition:transform .05s ease,background .2s ease;
      font-size:0.95rem;
    }
    button:active{transform:scale(.98)}
    .primary{background:var(--accent);border-color:transparent;color:#071d10}
    .card{
      position:relative;
      background:var(--card);
      border:1px solid rgba(0,0,0,0.12);
      border-radius:16px;
      min-height:44vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:30px;
      user-select:none;
      box-shadow:0 10px 30px rgba(0,0,0,.12);
    }
    .term{font-size:clamp(28px,5vw,54px);font-weight:800;margin-bottom:10px}
    .desc{font-size:1rem;color:var(--muted);max-width:80%;line-height:1.3;white-space:pre-line}
    .lang{position:absolute;top:12px;left:16px;color:var(--muted);font-weight:700;font-size:.95rem}
    .status{position:absolute;top:12px;right:16px;color:var(--muted);font-size:.95rem}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px}
    .grow{flex:1}
    .muted{color:var(--muted)}
    @media (max-width:520px){
      .card{padding:20px}
      .term{font-size:28px}
      button,input[type="file"],select{padding:8px 10px;font-size:.9rem}
    }
    .file-import {
      display:flex;
      gap:8px;
      align-items:center;
    }
    .file-import input[type="file"] {
      flex:1;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>EN ‚áÑ CA Flashcards</h1>
        <div class="sub">Click card to flip ‚Ä¢ <b>Space</b> to flip ‚Ä¢ <b>‚Üí</b>/<b>‚Üê</b> next/prev</div>
      </div>
      <div class="toolbar">
        <button id="modeBtn">üåô Toggle Mode</button>
        <button id="exportBtn">Export</button>
        <div class="file-import">
          <input type="file" id="importFile" accept=".json,application/json">
          <button id="importBtn">Import</button>
        </div>
        <button id="shuffleBtn">Shuffle</button>
      </div>
    </header>

    <main>
      <div class="card" id="card" role="button" tabindex="0" aria-pressed="false">
        <div class="lang" id="langLabel">EN</div>
        <div class="status" id="status">0 / 0</div>
        <div class="term" id="term">Loading‚Ä¶</div>
        <div class="desc" id="desc"></div>
      </div>

      <div class="row" style="margin-top:14px;">
        <div class="grow">
          <span class="muted">Deck:</span>
          <select id="deckSelect" aria-label="Select deck"></select>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevBtn">‚Üê Prev</button>
          <button id="flipBtn" class="primary">Flip</button>
          <button id="nextBtn">Next ‚Üí</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // --- Example decks (default) ---
    let decks = {
      animals: [
        { EN: "Dog", CA: "Gos", desc: "El gos est√† al jard√≠.\n<i>The dog is in the garden.</i>" },
        { EN: "Cat", CA: "Gat", desc: "Aquells dos sempre estan com gat i gos.\n<i>Those two are always arguing.</i>" },
        { EN: "Bird", CA: "Ocell", desc: "Hi ha un ocell al niu.\n<i>There's a bird in the nest.</i>" }
      ],
      food: [
        { EN: "Bread", CA: "Pa", desc: "El pa amb tom√†quet √©s el meu menjar preferit.\n<i>My favourite food is bread with tomato.</i>" },
        { EN: "Cheese", CA: "Formatge", desc: "Vols formatge?\n<i>Do you want cheese?</i>" },
        { EN: "Apple", CA: "Poma", desc: "Aix√≤ √©s past√≠s de poma.\n<i>This is apple pie</i>" }
      ],
      transport: [
        { EN: "Car", CA: "Cotxe", desc: "El cotxe √©s m√©s lent que el tren.\n<i>The car is slower than the train.</i>" },
        { EN: "Train", CA: "Tren", desc: "El tren √©s m√©s r√†pid que el cotxe.\n<i>The train is faster than the car.</i>" },
        { EN: "Bicycle", CA: "Bicicleta", desc: "No s√© anar en bicicleta.\n<i>I don't know how to ride a bicycle.</i>" }
      ]
    };

    // --- State ---
    let currentDeckName = Object.keys(decks)[0] || null;
    let currentDeck = currentDeckName ? decks[currentDeckName] : [];
    let currentIndex = 0;
    let showingEN = true;
    let selectedFile = null;

    // --- DOM ---
    const deckSelect = document.getElementById("deckSelect");
    const flashcard = document.getElementById("card");
    const termEl = document.getElementById("term");
    const descEl = document.getElementById("desc");
    const langEl = document.getElementById("langLabel");
    const statusEl = document.getElementById("status");

    const flipBtn = document.getElementById("flipBtn");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importFile = document.getElementById("importFile");
    const importBtn = document.getElementById("importBtn");
    const modeBtn = document.getElementById("modeBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");

    // --- Helpers ---
    function populateDecks() {
      const keys = Object.keys(decks);
      deckSelect.innerHTML = "";
      keys.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name.charAt(0).toUpperCase() + name.slice(1);
        deckSelect.appendChild(opt);
      });
      if (currentDeckName && decks[currentDeckName]) {
        deckSelect.value = currentDeckName;
      } else {
        currentDeckName = keys[0] || null;
        deckSelect.value = currentDeckName || "";
      }
    }

    function loadDeck(name) {
      if (!name || !decks[name]) {
        currentDeck = [];
        currentDeckName = null;
        currentIndex = 0;
        showingEN = true;
        renderCard();
        return;
      }
      currentDeckName = name;
      currentDeck = decks[name];
      currentIndex = 0;
      showingEN = true;
      renderCard();
    }

    function renderCard() {
      if (!currentDeck || !currentDeck.length) {
        termEl.textContent = "No cards in this deck.";
        descEl.textContent = "";
        langEl.textContent = showingEN ? "EN" : "CA";
        statusEl.textContent = "0 / 0";
        flashcard.setAttribute("aria-pressed", "false");
        return;
      }
      const card = currentDeck[currentIndex];
      termEl.textContent = showingEN ? (card.EN || "") : (card.CA || "");
      descEl.innerHTML = showingEN ? "" : (card.desc || "");
      langEl.textContent = showingEN ? "EN" : "CA";
      statusEl.textContent = `${currentIndex + 1} / ${currentDeck.length}`;
      flashcard.setAttribute("aria-pressed", showingEN ? "false" : "true");
    }

    function flip() { showingEN = !showingEN; renderCard(); }
    function next() { if (currentDeck && currentIndex < currentDeck.length - 1) { currentIndex++; showingEN = true; renderCard(); } }
    function prev() { if (currentDeck && currentIndex > 0) { currentIndex--; showingEN = true; renderCard(); } }

    // --- Shuffle ---
    function shuffleDeck() {
      if (!currentDeck || currentDeck.length === 0) return;
      for (let i = currentDeck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
      }
      currentIndex = 0;
      showingEN = true;
      renderCard();
    }

    // --- Events ---
    flipBtn.addEventListener("click", flip);
    nextBtn.addEventListener("click", next);
    prevBtn.addEventListener("click", prev);
    flashcard.addEventListener("click", flip);
    shuffleBtn.addEventListener("click", shuffleDeck);

    deckSelect.addEventListener("change", (e) => {
      loadDeck(e.target.value);
    });

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") { e.preventDefault(); flip(); }
      else if (e.code === "ArrowRight") { next(); }
      else if (e.code === "ArrowLeft") { prev(); }
    });

    // Export decks
    exportBtn.addEventListener("click", () => {
      try {
        const blob = new Blob([JSON.stringify(decks, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "flashcards.json";
        a.click();
        URL.revokeObjectURL(url);
      } catch (err) {
        alert("Export failed: " + err.message);
      }
    });

    // Import
    importFile.addEventListener("change", (e) => {
      selectedFile = e.target.files && e.target.files[0] ? e.target.files[0] : null;
    });

    importBtn.addEventListener("click", () => {
      if (!selectedFile) {
        alert("Please choose a JSON file first (using the file input).");
        return;
      }
      const reader = new FileReader();
      reader.onload = (evt) => {
        try {
          const imported = JSON.parse(evt.target.result);
          if (typeof imported !== "object" || imported === null || Array.isArray(imported)) {
            alert("Invalid JSON format: expected an object with deck names as keys.");
            return;
          }
          for (const deckName in imported) {
            if (!Object.prototype.hasOwnProperty.call(imported, deckName)) continue;
            const value = imported[deckName];
            if (!Array.isArray(value)) continue;
            decks[deckName] = value;
          }
          const prevDeck = currentDeckName;
          populateDecks();
          const toLoad = (prevDeck && decks[prevDeck]) ? prevDeck : (Object.keys(decks)[0] || null);
          if (toLoad) loadDeck(toLoad);
          alert("Import successful.");
          importFile.value = "";
          selectedFile = null;
        } catch (err) {
          alert("Error parsing JSON: " + (err && err.message ? err.message : String(err)));
        }
      };
      reader.readAsText(selectedFile);
    });

    // Dark/Light mode
    modeBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark");
    });

    // --- Init ---
    populateDecks();
    loadDeck(currentDeckName);
  </script>
</body>
</html>
